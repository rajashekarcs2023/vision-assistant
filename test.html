<!DOCTYPE html>
<html>
<head>
    <title>Pi WebSocket Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .status { font-size: 18px; margin: 10px 0; }
        .connected { color: green; }
        .disconnected { color: red; }
        .data { background: #f0f0f0; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>ğŸ¤– SentientSight Pi Connection Test</h1>
    <div id="status" class="status disconnected">ğŸ”Œ Connecting to Pi...</div>
    <div><strong>Network Quality Test Complete!</strong> 0% packet loss detected.</div>
    <div id="data" class="data">Waiting for sensor data...</div>
    
    <script>
        const statusDiv = document.getElementById('status');
        const dataDiv = document.getElementById('data');
        
        console.log('ğŸ” Connecting to Pi WebSocket...');
        console.log('â° Test started at:', new Date().toLocaleTimeString());
        const ws = new WebSocket('ws://192.168.137.8:8765');
        
        ws.onopen = () => {
            statusDiv.innerHTML = 'âœ… Connected to Pi!';
            statusDiv.className = 'status connected';
            console.log('âœ… WebSocket connected successfully!');
        };
        
        ws.onerror = (error) => {
            statusDiv.innerHTML = 'âŒ Connection Failed';
            statusDiv.className = 'status disconnected';
            console.log('âŒ WebSocket connection failed:', error);
        };
        
        ws.onmessage = (event) => {
            try {
                const sensorData = JSON.parse(event.data);
                const motion = sensorData.accelerometer?.is_moving ? 'Moving' : 'Still';
                const distance = sensorData.ultrasonic?.distance_cm || 'N/A';
                const hasCamera = sensorData.camera?.image_data ? 'ğŸ“·' : 'ğŸ“·âŒ';
                
                dataDiv.innerHTML = `
                    <strong>Live Sensor Data:</strong><br>
                    Motion: ${motion}<br>
                    Distance: ${distance}cm<br>
                    Camera: ${hasCamera}<br>
                    Time: ${new Date(sensorData.timestamp * 1000).toLocaleTimeString()}
                `;
                
                console.log('ğŸ“¡ Received sensor data:', sensorData);
            } catch (e) {
                console.error('Error parsing sensor data:', e);
            }
        };
        
        ws.onclose = (event) => {
            statusDiv.innerHTML = 'ğŸ”Œ Disconnected';
            statusDiv.className = 'status disconnected';
            console.log('ğŸ”Œ WebSocket closed. Code:', event.code);
        };
    </script>
</body>
</html>